# 鉛筆デッサンコーチングエージェント プロダクト要求定義書

## プロダクトビジョンと目的

### ビジョン
鉛筆デッサンを学ぶユーザーに対して、Google Cloud AIを活用したパーソナライズされたフィードバックと改善提案を行うコーチングエージェントを提供する。

### 目的
- 鉛筆デッサンの基礎技術習得をサポート
- 形、陰影、質感など鉛筆デッサン特有の観点から具体的なフィードバックを提供
- 改善例を画像として生成し、視覚的な学習を促進
- Google Cloud Agents Development Kit (ADK) を活用したエージェンティックAIの実現

### 鉛筆デッサンに特化する理由
- 評価基準の明確化（線の質、陰影表現、プロポーションなど）
- モノクロ表現に集中することで分析精度向上
- 美術の基礎として多くの学習者がいる分野
- フィードバックの専門性を高めることでユーザー価値向上

---

## ターゲットユーザーと課題・ニーズ

### ターゲットユーザー
1. **美術初心者**: デッサンを始めたばかりで基礎を学びたい人
2. **美術系学生**: 受験や課題のためにデッサン力を向上させたい学生
3. **趣味のアーティスト**: 独学でデッサンを練習している人
4. **イラストレーター志望**: 基礎画力を強化したいクリエイター

### 課題・ニーズ
| 課題 | ニーズ |
|------|--------|
| デッサン教室や個人レッスンは高コスト・時間がかかる | 即時でアクセス可能なフィードバック |
| 独学では何が悪いのか気づきにくい | 客観的な分析と具体的な改善提案 |
| テキストだけでは「正しい陰影」が分かりにくい | 視覚的な改善例（お手本画像） |
| 継続的な練習のモチベーション維持が困難 | 成長の可視化とランク制度 |

---

## 主要な機能一覧

### 核となる機能

| # | 機能名 | 説明 | 優先度 |
|---|--------|------|--------|
| 1 | GitHub PR通知受信 | ユーザーの画像リポジトリへのPR作成をGitHub Actionsで検知 | P0 |
| 2 | モチーフ識別・タグ付け | デッサンの対象物（リンゴ、球体、静物など）を識別しタグ付け | P0 |
| 3 | デッサン分析・評価 | Vertex AI（gemini-3-flash-preview）の画像理解機能でデッサンを分析し、技術的観点から評価 | P0 |
| 4 | 改善提案生成 | プロポーション、陰影、線の質等の改善点をテキストでフィードバック | P0 |
| 5 | お手本画像生成（非同期） | Vertex AI（gemini-2.5-flash-image）を使用して改善例を画像生成 | P1 |
| 6 | PRコメント投稿（2段階） | 即時: テキストフィードバック → 後続: 生成画像を追加コメント | P0 |

### 補助機能

| # | 機能名 | 説明 | 優先度 |
|---|--------|------|--------|
| 7 | ランク制度 | 上達に応じたランク付け（10級〜1級〜初段〜師範） | P1 |
| 8 | 対話的フィードバック | ユーザーからの追加質問に応答 | P2 |
| 9 | 進捗トラッキング | 過去の提出作品との比較・成長分析 | P3 |

---

## デッサン評価の観点

### 評価カテゴリ

| カテゴリ | 評価項目 | 説明 |
|----------|----------|------|
| **プロポーション** | 形の正確さ | 対象物の形が正確に捉えられているか |
| | 比率・バランス | 各部分の比率が適切か |
| | 輪郭線 | 輪郭の取り方が適切か |
| **陰影（トーン）** | 明暗の階調 | 10段階程度の明暗が表現できているか |
| | 光源の一貫性 | 光の方向が統一されているか |
| | 立体感 | 陰影による立体感が出ているか |
| **質感表現** | 素材感 | 素材の質感（金属、布、肌など）が表現できているか |
| | タッチの使い分け | 素材に応じたタッチを使えているか |
| **線の質** | 運筆 | 線の引き方が滑らかで意図的か |
| | 筆圧コントロール | 筆圧の強弱を使い分けられているか |
| | ハッチング | クロスハッチングなどの技法が適切か |
| **構図** | 配置 | モチーフの配置が適切か |
| | 余白バランス | 紙面の使い方が適切か |
| **仕上げ** | 完成度 | 全体的な仕上がりのレベル |
| | 統一感 | 描き込みの密度が統一されているか |

---

## 成功の定義

### 定量的指標
- **即時フィードバック時間**: テキストフィードバックが30秒以内に投稿される
- **画像生成完了時間**: お手本画像が2分以内に追加コメントとして投稿される
- **画像生成成功率**: 95%以上のリクエストでお手本画像が正常生成
- **ユーザー満足度**: フィードバックの有用性評価が4.0/5.0以上

### 定性的指標
- ユーザーがフィードバックを実践し、デッサン力向上を実感できる
- 改善例の画像が具体的で理解しやすい
- 専門的なアドバイスが得られると感じる

---

## ビジネス要件

### 運用要件
- **可用性**: 99.5%以上のアップタイム
- **スケーラビリティ**: 同時10リクエストを処理可能
- **コスト**: 月間運用コストを$100以下に抑制（ハッカソン期間中は無料枠活用）

### セキュリティ要件
- ユーザーの画像データは処理後即時削除
- GitHub認証はGitHub App経由で安全に実施
- API認証・認可の実装

---

## ユーザーストーリー

### US-001: デッサンの提出とフィードバック受信
**役割**: 美術初心者  
**目的**: 描いたデッサンに対するフィードバックを受けたい  
**理由**: 独学では気づけない改善点を知りたいから

**受け入れ条件**:
- [ ] デッサン画像を含むPRを作成できる
- [ ] PRコメントにフィードバックが投稿される
- [ ] フィードバックには具体的な改善提案が含まれる
- [ ] プロポーション、陰影、線の質について評価される

### US-002: 改善例の画像を確認
**役割**: 趣味のアーティスト  
**目的**: 改善後のイメージを視覚的に確認したい  
**理由**: テキストだけでなく実際の画像で理解を深めたいから

**受け入れ条件**:
- [ ] お手本画像がPRコメントに添付される
- [ ] 画像がオリジナルの改善版として認識できる
- [ ] どこがどう改善されたか説明がある

### US-003: ランクの確認と成長実感
**役割**: 美術系学生  
**目的**: 自分のデッサンレベルを知りたい  
**理由**: 上達を実感してモチベーションを維持したいから

**受け入れ条件**:
- [ ] 現在のランクがフィードバックに表示される
- [ ] 高評価が続くとランクが上がる
- [ ] ランクに応じたフィードバックの難易度調整がある

---

## 機能要件

### FR-001: GitHub Actions統合
- GitHub Actionsでエージェントに通知
- PR作成イベントをトリガーに処理開始
- 画像ファイルのURL抽出とダウンロード

### FR-002: デッサン分析エンジン
- Vertex AI経由でマルチモーダルモデル（gemini-3-flash-preview）を利用
- 対応形式: JPEG, PNG, WebP
- 最大画像サイズ: 10MB
- **鉛筆デッサン特化の分析プロンプト**

### FR-003: フィードバック生成
- 分析結果に基づく構造化されたフィードバック
- 評価カテゴリ:
  - プロポーション（形の正確さ、比率）
  - 陰影（明暗の階調、立体感）
  - 線の質（運筆、ハッチング）
  - 質感表現（素材感）
  - 構図・仕上げ

### FR-004: お手本画像生成
- Vertex AI経由でgemini-2.5-flash-imageを使用
- 鉛筆デッサン風のスタイルを維持
- 改善点を反映した参考画像を生成
- 生成画像にはAI生成であることを明記

### FR-005: GitHub API統合
- PRコメント投稿機能
- 画像ファイルのアップロード（Base64 or URL）
- Rate Limit対応

### FR-006: ランク管理
- ユーザーごとのランク情報を永続化（Firestore）
- 評価スコアに基づく昇格判定
- ランク別のフィードバックトーン調整

---

## 非機能要件

### パフォーマンス
- **フェーズ1（即時フィードバック）**: 30秒以内にテキストフィードバックを投稿
- **フェーズ2（画像生成）**: 非同期で実行、完了後に追加コメントとして投稿
- 画像生成時間: 60〜120秒

### 信頼性
- 失敗時のリトライ機構（最大3回）
- エラー通知（Slack/Email連携はオプション）

### 保守性
- 構造化されたログ出力
- OpenTelemetry対応のトレーシング

### 拡張性
- 新しい評価カテゴリの追加が容易
- 複数のAIモデルへの切り替えが可能

---

## Google Cloud 技術要件（ハッカソン対応）

### 必須：アプリケーション実行プロダクト
- **Cloud Run**: エージェントのホスティング（サーバーレス）

### 必須：AI技術
- **Vertex AI**: AIモデルのデプロイ・管理（Gemini API経由を含む）
- **gemini-3-flash-preview（Vertex AI経由）**: マルチモーダル画像分析・フィードバック生成
- **gemini-2.5-flash-image（Vertex AI経由）**: お手本画像生成
- **ADK (Agents Development Kit)**: エージェント構築フレームワーク

### 任意：その他の技術
- **Firestore**: ユーザーランクデータの永続化
- **Cloud Tasks**: 非同期処理キュー
- **Secret Manager**: GitHub App秘密鍵管理
- **Cloud Logging / Monitoring**: 可観測性
- **Artifact Registry**: コンテナイメージ管理

> **Note**: 生成画像はGitHubコメントにBase64で直接埋め込むため、Cloud StorageやCloud CDNは使用しません。

